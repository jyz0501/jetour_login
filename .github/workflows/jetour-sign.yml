
name: Jetour Auto Worker

# 触发器：每天UTC时间16点（北京时间0点）和2点（北京时间10点）执行
# 注意：GitHub Actions使用UTC时间，需要转换为北京时间
on:
  schedule:
    # 每天UTC时间16点（北京时间0点）执行
    - cron: '0 16 * * *'
    # 每天UTC时间2点（北京时间10点）执行
    - cron: '0 2 * * *'
  # 允许手动触发
  workflow_dispatch:

# 工作流任务
jobs:
  jetour-auto-worker:
    # 运行环境
    runs-on: ubuntu-latest

    steps:
      # 1. 安装Git（如果需要）
      - name: Install Git
        run: |
          sudo apt-get update
          sudo apt-get install -y git
      
      # 2. 克隆代码仓库
      - name: Clone Repository
        run: |
          git clone https://github.com/jyz0501/jetour_login.git .
          git checkout main
      
      # 3. 检查Python版本
      - name: Check Python Version
        run: |
          python3 --version
      
      # 4. 安装依赖
      - name: Install Dependencies
        run: |
          python3 -m pip install --upgrade pip
          pip3 install requests
      
      # 5. 执行捷途自动工作脚本
      - name: Run Jetour Auto Worker
        env:
          # 从GitHub Secrets中获取敏感信息，直接传递给脚本
          JETOUR_ACCESS_TOKEN: ${{ secrets.JETOUR_ACCESS_TOKEN }}
          JETOUR_TASK_ID: ${{ secrets.JETOUR_TASK_ID }}
        run: |
          # 直接执行自动工作脚本
          python3 jetour_auto_worker.py
      
      # 6. 执行信息提取脚本（用于更新仪表盘）
      - name: Run Jetour Sign Info Extractor
        env:
          # 从GitHub Secrets中获取敏感信息，直接传递给脚本
          ACCESS_TOKEN: ${{ secrets.JETOUR_ACCESS_TOKEN }}
          TASK_ID: ${{ secrets.JETOUR_TASK_ID }}

        run: |
          # 执行信息提取脚本，用于更新仪表盘数据
          python3 extract_jetour_sign_info.py
