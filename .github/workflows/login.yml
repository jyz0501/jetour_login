name: Jetour Sign Info Extraction

# 触发器：每天UTC时间0点执行（北京时间8点）
on:
  schedule:
    - cron: '0 0 * * *'
  # 允许手动触发
  workflow_dispatch:

# 工作流任务
jobs:
  extract-sign-info:
    # 运行环境
    runs-on: ubuntu-latest
    
    steps:
      # 1. 检出代码仓库
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      # 2. 设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      # 3. 安装依赖
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests PyYAML
      
      # 4. 执行捷途签到信息提取脚本
      - name: Run Jetour Sign Info Extractor
        env:
          # 从GitHub Secrets中获取敏感信息，直接传递给脚本
          ACCESS_TOKEN: ${{ secrets.JETOUR_ACCESS_TOKEN }}
          TASK_ID: ${{ secrets.JETOUR_TASK_ID }}
        run: |
          # 直接执行脚本，脚本会从环境变量读取配置
          python extract_jetour_sign_info.py
      
      # 5. 部署到GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # 使用GitHub Secrets中的GITHUB_TOKEN
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # 部署目录（当前目录下的所有文件）
          publish_dir: .
          # 部署分支
          publish_branch: gh-pages
          # 允许空提交
          allow_empty_commit: true
          # 清理旧文件
          force_orphan: true
          # 仅部署必要文件
          include_files: 'index.html,sign-data.json,.nojekyll'
